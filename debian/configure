#!/bin/bash
# dpkg configuration script for linuxcnc
# Copyright (C) 2006 Jeff Epler
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# When used to produce a debian package, this file is a script "used to
# control compilation and installation of the executable"

set -e

usage () {
    P=${0##*/}
    cat <<EOF
$P: Obsolete script to set up debian/ files to build for a particular kernel

Usage:
  $P
EOF
}

cd "${0%/*}"

if [ "$1" == "-h" -o "$1" == "-help" -o "$1" == "--help" ]; then
    usage
    exit 0
fi

ENABLE_BUILD_DOCUMENTATION=yes

# Specialize these based on DISTRIB_NAME as needed
# These do not run-time depend on a specific package because
# the whole point is to allow a range of kernels to work, and we don't know
# of any common thing that all such kernels would provide.

while test $# -ne 0; do
    case "$1" in
    sim|uspace|noauto) echo "$1 is accepted for compatibility, but ignored";;
    no-docs) unset ENABLE_BUILD_DOCUMENTATION ;;
    *) echo 1>&2 "Unknown option: $1"; exit 99 ;;
    esac
    shift
done

DISTRIB_NAME=
if [ "$(command -v lsb_release)" != "" ] || [ "$(which lsb_release)" != "" ]; then
    DISTRIB_NAME="$(lsb_release -s -i)-$(lsb_release -s -r)"
elif [ -f /etc/lsb-release ]; then
    source /etc/lsb-release
    DISTRIB_NAME=$DISTRIB_ID-$DISTRIB_RELEASE
fi

DISTRIB_NAME=uspace-$DISTRIB_NAME

if [ -z "$ENABLE_BUILD_DOCUMENTATION" ]; then
    echo "error: No need to run debian/configure any more."
    echo "To build without documentation use:"
    echo "   DEB_BUILD_OPTIONS=nodoc DEB_BUILD_PROFILES=nodoc debuild"
    exit 1
fi

rm -f ../build-stamp
echo "successfully configured for '$DISTRIB_NAME'.."
